

# 小程序 day_02



## 预览

### 问题

* 目前我们完成了小程序的首页面，如果通过开发工具=>预览=>扫码，会遇到一个**错误提示**，如图所示：

![1580474378657](assets/1580474378657.png)

* 错误的原因：微信官方要求小程序代码包体积不允许超过 2M，其中图片资源占用了较大部分空间，然而实际项目中图片资源都是通过服务器返回，而非本地资源，所以 2M 的大小可以满足大部分的需求。





### 解决

* 未来：服务器上都是打包后的代码，图片都会服务器上；
* 现在：我们在学习阶段，又没有自己的服务器，但是我们又想看看效果；把图片上传到GitHub上，设置网站静态资源；把wxml里面标签内使用图片上传到服务器内；
* 1.单独的把图片文件夹拿出来一份：

![1580475041146](assets/1580475041146.png)

* 2.把上传到github：init，add，commit，push

![1580475390397](assets/1580475390397.png)

* 3.设置为网站的静态资源：

![1580475554789](assets/1580475554789.png)

* 4.测试： https://zc3hd.github.io/wxapp_img/slide_3.jpg

![1580475740884](assets/1580475740884.png)

* 5.页面代码替换：可以打开我们的编辑器

![1580476004072](assets/1580476004072.png)

* 6.打包的设置：
  
  * *packOptions*：打包设置
    
    * ignore：忽略打包编译项目：
    
      ![1581078423738](assets/1581078423738.png)
    
  * 文档：

![1580476153224](assets/1580476153224.png)

* 找到：packOptions ignore

![1580476204285](assets/1580476204285.png)

![1580476494180](assets/1580476494180.png)



### 其他

* 1.把static文件夹下面的图片上传到GitHub，在 **wxml的标签** 内可以使用；在**wxss**内使用相对路径：会有报错；**在wxss文件内使用网络图片**

![1580479014604](assets/1580479014604.png)



* 2.为什么没有icons上传到服务器上？

![1580479206932](assets/1580479206932.png)

* **tabBar不支持网络图片**

![1580479255723](assets/1580479255723.png)



* 3.小图标：字体图标，iconfonts下载到本地，上传到服务上，wxss里面全部使用网络地址；**注意：wxapp服务器地址需要为https，不然会有问题**
  * 字体图片下载：https://icomoon.io/
  * 上传自己的图标 svg格式（UI设计）

![1580481846811](assets/1580481846811.png)









## 发布

### 上传

* 上传代码到后台，界面中可以看到，但只是在微信的服务器上，没有正式发布；

![1580482508077](assets/1580482508077.png)

![1580482609031](assets/1580482609031.png)



### 体验

* 点击提交审核右侧的下拉箭头，设置为体验版本：

![1580482703925](assets/1580482703925.png)

![1580482812324](assets/1580482812324.png)

* 设置成功后，出现二维码：

![1580482852556](assets/1580482852556.png)



* 哪些人可以称为体验者？**公司的测试人员**

![1580482969205](assets/1580482969205.png)



### 提交审核

* 测试人员测试完成，没有bug，提交审核给微信的审核人员；

![1580483164699](assets/1580483164699.png)

![1580483236749](assets/1580483236749.png)

![1580483320982](assets/1580483320982.png)

## 小结

* 开始
  * 公司：申请wxapp，得到wxappID
  * 开发人员：
    * 找主管要wxappID
    * 添加我们为开发人员；可以开发了；
  * 体验人员：测试
* 开发：
  * 文件地址，建议使用**网络地址**
    * wxml：可以使用相对路径，和网络地址
    * wxss：使用base64或网络地址
  * 文件配置project.config.json
    * 忽略本地的图片文件夹；
* 发布
  * 1.上传代码到小程序管理后台（开发人员）
  * 2.设置体验本版，进行测试；（测试人员）
  * 3.测试完毕后，提交审核；
  * 4.审核成功后，发布；



## 注意！

### 编辑器

* VSC插件：**minapp**，在编辑里编辑我们的代码；小程序的IDE就编辑器可以关了；

![1580523262882](assets/1580523262882.png)

![1580523323506](assets/1580523323506.png)

* 小程序的IDE就编辑器：
  * 新建page；自动会在`app.json`添加路径
  * 指定测试页等

![1580533830718](assets/1580533830718.png)



### 新样式v2

* 设置新样式不会真实的覆盖掉内置的样式，尽管引进划了横线；

![1580535008295](assets/1580535008295.png)



* 解决：
  * 提高CSS权重
  * 不使用v2版本：（现在只有原来版本，和新版本v2）

![1580535111578](assets/1580535111578.png)



### 真机调试

![1580536112618](assets/1580536112618.png)

* 鼠标放入dom上时，手机会实时显示状态

![1580536284426](assets/1580536284426.png)

![1580536260451](assets/1580536260451.png)





## 数据渲染

* 初始化函数Page(),参数为对象{}，且为必须传入的；

```js
Page({
  // 页面初始化数据 和vue类似；
  data:{}
  // 事件的回调函数（执行函数）

  // 生命周期函数
})
```

### {{}}

* 简单数据展示

```js
Page({
  /**
   * 页面的初始数据
   */
  data: {
    msg: "xxxx info",
    a: 1,
    b: 2,
    flag: true,
    list: [1, 2, 3],
    obj: {
      name: "xx"
    }
  },
})
```

```html
<view>{{msg}}</view>
<view>{{a+b}}</view>
<view>{{flag?"Y":"N"}}</view>
<view>{{list[0]}}</view>
<view>{{obj.name}}</view>
```

* 标准属性：

```html
<view class="{{obj.name}}"></view>
```









### wx:for

* **wx:for 属性将当前组件按着数组的长度动态创建，并且通过 index 变量可以访问到数组的索引值，通过item变量可以访问到单元值。**
* 格式注意：wx:for="{{list}}",必须加{} 大括号

![1580529469750](assets/1580529469750.png)

* 如果要替换默认的item和index变量：

![1580529541949](assets/1580529541949.png)

* 使用 `wx:key` 来指定列表中项目的唯一的标识符
  * 字符串，代表在 for 循环的 array 中 item 的某个 property，该 property 的值需要是列表中唯一的字符串或数字，且不能动态改变。
  * 保留关键字 `*this` 代表在 for 循环中的 item 本身，这种表示需要 item 本身是一个唯一的字符串或者数字，如

```html
// wx:key 后面需要填入对象里面 可以区分数据区别的属性名！不需要加{{}}！不需要写为item.a
<button type="primary" wx:for="{{list}}" wx:key="a">
  {{index}}----->{{item.str}}
</button>
<button type="primary" wx:for="{{list}}" wx:key="index">
  {{index}}----->{{item.str}}
</button>


// 如果实在找不到唯一的区别，就用默认的关键字 *this
<button type="primary" wx:for="{{list}}" wx:key="*this">
   {{index}}----->{{item.str}}
</button>
```





### wx:if

* 基础使用：

![1580531567240](assets/1580531567240.png)

* 如果是同一个判断条件，输出多个标签：使用block标签

```html
<view class="item" wx:key="*this" wx:for="{{users}}" wx:for-item="user">
  <text>{{index+1}}</text>
  <text>{{user.name}}</text>
  <text>{{user.age}}</text>
  <text>{{user.gender}}</text>

  <!-- block：就是配合 if 输出多个不同标签 -->
  <block wx:if="{{user.age >= 18}}">
    <text>是</text>
    <text>是</text>
  </block>

  <block wx:else>
    <text>否</text>
    <text>否</text>
  </block>
</view>
```



### hidden

* 控制元素节点是否显示在视图中：`<view hidden>asdsa</view>`;
  * true：隐藏
  * false：显示

![1580532794365](assets/1580532794365.png)

* 如何设置：`<view hidden="{{false}}">asdsa</view>`

* **思考：小程序这，只要是变量或者直接的数据，都需要带{{}}，如果不带，就会把”“里面数据作为字符串了；**



## 事件回调函数

### 基本语法

* 注册：
  * bind事件类型=”事件执行函数名“
  * bind:事件类型=”事件执行函数“   (推荐使用，清晰看见事件类型)
  * 事件类型：
    * tap：手指点击屏幕
    * focus：获取焦点
    * blur：失去焦点

![1580538171934](assets/1580538171934.png)



### 事件对象

* 语法：

```js
  btn(e) {
    console.log(e);
  }
```

* 用处：**自定义属性**的获取（回想原生JS自定义属性的获取）

![1580538928254](assets/1580538928254.png)





### this

* this：返回的是Page函数执行后的实例化；
* 但是：(没有像vue那么高级封装)
  * 上面没有data上的所有属性
  * 也没有对属性设置setter getter 

* **执行方法：实现数据与视图的同步更新，setData()，会自动新传入的对象内，修改变化的属性值进行同步；**

![1580539814891](assets/1580539814891.png)

* data调试工具：

![1580539934852](assets/1580539934852.png)





## 请求

* 小程序不支持 XMLHttpRequset、axios、$.ajax不能使用；

### 基础语法

* 文档地址：https://developers.weixin.qq.com/miniprogram/dev/api/network/request/wx.request.html

```js
wx.request({
    url: "https://m.maoyan.com/ajax/movieOnInfoList",
    method: "GET",
    data: {},
    success: function() {},
    fail: function() {}
});
```



### 线上配置

* 直接点击发生，会有下面报错：

![1580542816414](assets/1580542816414.png)

* 需要在后台配置域名

  

* ![1606897476301](assets/1606897476301.png)

![1580542936916](assets/1580542936916.png)

![1580542989630](assets/1580542989630.png)



### 开发阶段配置

* 本地设置：不校验合法域名；
* 注意上线前，要把域名换过来；

![1580543098446](assets/1580543098446.png)

* 请求回来的数据设置到视图上面，注意this的指向的绑定，或者设置变量，临时保存；

![1580543291520](assets/1580543291520.png)





## 练习：猫眼电影

### tab切换

* 查看当前页面路径：

![1580617095410](assets/1580617095410.png)

* 需求
  * 页面结构已经写好，实现点击切换
    * 1.点击 热映 待映（注册相应的点击事件）
    * 2.点击其中一个，给当前加类名，思考如何知道当前点击的是哪个？
      * 传入参数？**会报错，小程序事件的回调函数就是函数名，没有参数！**
      * 使用自定义属性（意义相当于是参数；）
    * 3.给点击的当前添加类名？如何添加？
      * 把获取到的数据，用变量保存起来，视图里面进行判断

* 代码
  * 1.注册点击事件
  * 2.如何知道当前点击的是哪个？

![1580617913973](assets/1580617913973.png)

![1580617945184](assets/1580617945184.png)

* 3.把获取到的数据，用变量保存起来

![1580618018682](assets/1580618018682.png)

* 4.在视图里面进行判断

![1580618059315](assets/1580618059315.png)





### onLoad  初始化加载数据

* https://blog.csdn.net/anana13/article/details/107554897

* 页面加载完后，请求服务端数据，渲染数据：

![1580619838391](assets/1580619838391.png)

* 页面加载后：周期函数 onload

![1580620077580](assets/1580620077580.png)

* 请求数据：

```js
    wx.request({
      url: "https://wx.maoyan.com/mmdb/movie/v2/list/hot.json",
      method: "GET",
      data: {
        limit: 12,
        offset: 0,
        ct: "北京",
      },
      success: function(res) {
        console.log(res);
      }
    })
```

* 出现报错：

![1580620416822](assets/1580620416822.png)

* 配置及查看：

![1580620439857](assets/1580620439857.png)

![1580620474290](assets/1580620474290.png)

* 拿到返回的数据：

![1580620667493](assets/1580620667493.png)

* 图片服务器：需要在渲染之前处理数据：

![1580621067893](assets/1580621067893.png)

* 注意：
  * 猫眼电影图片信息，从wxml发送出的请求，都算静态资源的请求，不需要设置备案；
  * 只有通过JS api调用的接口都需要备案；



